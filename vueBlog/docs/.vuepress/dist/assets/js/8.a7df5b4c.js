(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{214:function(t,v,_){"use strict";_.r(v);var a=_(0),T=Object(a.a)({},(function(){var t=this,v=t.$createElement,_=t._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"http3"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#http3"}},[t._v("#")]),t._v(" HTTP3")]),t._v(" "),_("p",[t._v("上文曾提到过，在QUIC上传输的第一个主要协议的HTTP。")]),t._v(" "),_("p",[t._v("就像HTTP/2是通过网络传输HTTP流量的一种新方式，HTTP/3是另一种通过网络传输HTTP的新方法。")]),t._v(" "),_("p",[t._v("HTTP的范例和概念没有改变。它含有头部（header）和正文（body），请求 (request) 和回复 (response)，还有动词（verb）和缓存。HTTP/3的主要改变是将这些报文传送到另一端的方式。")]),t._v(" "),_("p",[t._v("为了使HTTP可以通过QUIC传输，协议的某些方面要进行修改，结果便是HTTP/3。这些必要修改是因QUIC与TCP在某些性质上的不同所致，修改包括：")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("在QUIC中，数据流由传输层本身提供，而在HTTP/2中，流在HTTP层完成。")])]),t._v(" "),_("li",[_("p",[t._v("由于数据流互相独立，如果仍使用HTTP/2中使用的头部压缩算法，会造成队头阻塞。")])]),t._v(" "),_("li",[_("p",[t._v("QUIC流与HTTP/2略有不同。本书的HTTP/3章节会做详细介绍。")])])]),t._v(" "),_("h2",{attrs:{id:"https-url"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#https-url"}},[t._v("#")]),t._v(" HTTPS:// URL")]),t._v(" "),_("p",[t._v("HTTP/3将遵循HTTPS：//。世界上到处都是HTTPS URL，并且为新的协议引入另一种URL方案是不切实际的。如同HTTP/2一样，HTTP/3不会引入新的URL方案。")]),t._v(" "),_("p",[t._v("HTTP/2是传输HTTP的一种新方式，但是它还是和HTTP/1一样基于TLS和TCP。而在基于QUIC的HTTP/3中，情况更加复杂，它在一些重要的地方做了一些改变。")]),t._v(" "),_("p",[t._v("历史遗留下来的明文HTTP:// URL的处理方式将保持原样，随着我们迈入安全传输更加普及的未来，它的使用频率可能会越来越少。对HTTP URL的请求不会升级为使用HTTP/3。实际上，因为一些原因，它们也很少升级到HTTP/2。")]),t._v(" "),_("h3",{attrs:{id:"初始连接"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#初始连接"}},[t._v("#")]),t._v(" 初始连接")]),t._v(" "),_("p",[t._v("当尝试连接到一个全新的、未访问过的网站时，到HTTPS:// URL的连接可能必须通过TCP（也许会有并行的一个QUIC连接）。因为主机可能是一个不支持QUIC的老旧服务器，或者链路之间可能设置了阻碍QUIC成功连接的中间设备。")]),t._v(" "),_("p",[t._v("现代的浏览器和服务器大概在首次握手时使用HTTP/2协议。连接建立后，服务器可以通告客户端它对HTTP/3的支持与偏好。")]),t._v(" "),_("h2",{attrs:{id:"使用alt-svc自举"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#使用alt-svc自举"}},[t._v("#")]),t._v(" 使用Alt-svc自举")]),t._v(" "),_("h3",{attrs:{id:"alt-svc"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#alt-svc"}},[t._v("#")]),t._v(" Alt-svc")]),t._v(" "),_("p",[t._v("替代服务（alternative service, Alt-svc:）头部和它相对应的 ALT-SVC HTTP/2帧并不是特别为QUIC和HTTP/3设计的。它是为了让服务器可以告诉客户端 “看，我在这个主机的这个端口用这个协议提供相同的服务” 而设计的。请参阅"),_("a",{attrs:{href:"https://tools.ietf.org/html/rfc7838",target:"_blank",rel:"noopener noreferrer"}},[t._v("RFC 7838"),_("OutboundLink")],1),t._v("中的详细信息。")]),t._v(" "),_("p",[t._v("接收到Alt-svc响应的客户端(如果支持)在后台使用指定的协议并行连接到该给定的其他主机，如果成功则将其错做切换到该主机来代替初始的连接。")]),t._v(" "),_("p",[t._v("如果初始连接使用的是HTTP/2（甚至HTTP/1），服务器可以响应并告诉客户端它可以再尝试使用HTTP/3进行连接。连接可以指向相同主机或者不同但提供相同服务的主机。Alt-svc回复中有一个到期计时器，让客户端可以在指定的时间内使用建议的替代协议将后续的连接和请求直接发送给替代主机。")]),t._v(" "),_("h3",{attrs:{id:"例子"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[t._v("#")]),t._v(" 例子")]),t._v(" "),_("p",[t._v("一个HTTP服务器的响应中包含了如下的一个 Alt-Svc: 头部：")]),t._v(" "),_("div",{staticClass:"language-http extra-class"},[_("pre",{pre:!0,attrs:{class:"language-http"}},[_("code",[_("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Alt-Svc:")]),t._v(' h3=":50781"\n')])])]),_("p",[t._v("这表明了同一名称的主机在UDP端口50781提供HTTP/3服务。")]),t._v(" "),_("p",[t._v("然后，客户端可以尝试与该端口建立QUIC连接。如果成功，后续将通过该连接继续通信，代替初始的HTTP版本。")]),t._v(" "),_("h2",{attrs:{id:"quic流与http-3"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#quic流与http-3"}},[t._v("#")]),t._v(" QUIC流与HTTP/3")]),t._v(" "),_("p",[t._v("HTTP/3是为QUIC设计的，因此它充分利用了QUIC的流，但是HTTP/2必须基于TCP来设计它的整个流和自己的复用概念。")]),t._v(" "),_("p",[t._v("通过HTTP/3传输的HTTP请求使用一系列的特定数据流完成。")]),t._v(" "),_("h3",{attrs:{id:"http-3帧"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#http-3帧"}},[t._v("#")]),t._v(" HTTP/3帧")]),t._v(" "),_("p",[t._v("HTTP/3意味着建立QUIC数据流，并将一系列帧发送给对方。HTTP/3中的只有少量的已知数据帧（截至2018年12月18日有九种）。最关键的帧可能是：")]),t._v(" "),_("ul",[_("li",[t._v("HEADERS：发送压缩的HTTP头部")]),t._v(" "),_("li",[t._v("DATA：发送二进制数据内容")]),t._v(" "),_("li",[t._v("GOAWAY：请关闭此连接")])]),t._v(" "),_("h3",{attrs:{id:"http请求"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#http请求"}},[t._v("#")]),t._v(" HTTP请求")]),t._v(" "),_("p",[t._v("客户端通过其发起的双向QUIC流来发送HTTP请求。")]),t._v(" "),_("p",[t._v("一个请求包括一个HEADERS帧，之后可能有一两种其他的帧：一系列的DATA帧，以及可能有一个作为末尾的HEADERS帧。")]),t._v(" "),_("p",[t._v("发送一个请求后，客户端会关闭该数据流以进行发出。")]),t._v(" "),_("h3",{attrs:{id:"http响应"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#http响应"}},[t._v("#")]),t._v(" HTTP响应")]),t._v(" "),_("p",[t._v("服务器在双向流上发回其HTTP响应。包括一个HEADERS帧，一系列DATA帧，末尾可能有一个HEADERS帧。")]),t._v(" "),_("h3",{attrs:{id:"qpack头部"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#qpack头部"}},[t._v("#")]),t._v(" QPACK头部")]),t._v(" "),_("p",[t._v("HEADERS含有用QPACK算法压缩的HTTP头部。QPACK与HTTP/2中的HPACK（"),_("a",{attrs:{href:"https://httpwg.org/specs/rfc7541.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("RFC 7541"),_("OutboundLink")],1),t._v("）类似，并针对乱序流做了相应修改。")]),t._v(" "),_("p",[t._v("QPACK本身在两个端点间使用两个额外的单向QUIC流，用于在两个方向上传递动态表信息。")]),t._v(" "),_("h2",{attrs:{id:"优先度"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#优先度"}},[t._v("#")]),t._v(" 优先度")]),t._v(" "),_("p",[t._v("HTTP/3中有一种帧是优先度（PRIORITY）。与HTTP/2中的类似，它用于设定一个流的优先度和依赖关系。")]),t._v(" "),_("p",[t._v("该帧可以设定一个流依赖于另一个流，也可以设定特定流的“权重”。")]),t._v(" "),_("p",[t._v("服务器应该只在一个流所依赖的所有流都被关闭，或者都无法取得进展时为该流分配资源。")]),t._v(" "),_("p",[t._v("一个流的权重是介于1到256之间的值，有着相同父系流的流应该按照权重的比例分配资源。")]),t._v(" "),_("h2",{attrs:{id:"服务器推送"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#服务器推送"}},[t._v("#")]),t._v(" 服务器推送")]),t._v(" "),_("p",[t._v("HTTP/3的服务器推送与HTTP/2（"),_("a",{attrs:{href:"https://httpwg.org/specs/rfc7540.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("RFC 7540"),_("OutboundLink")],1),t._v("）类似，但机制上有所不同。")]),t._v(" "),_("p",[t._v("服务器推送实际上就是对一个未曾发出请求的客户端做出响应！")]),t._v(" "),_("p",[t._v("服务器推送仅在客户端同意的前提下才允许发出。在HTTP/3中，客户端甚至能通过通告给服务器的最大推送流ID来设置所接受推送的次数限制。超出限制将导致连接错误。")]),t._v(" "),_("p",[t._v("如果服务器端认为客户端可能需要某个并未要求但应该有的额外资源，服务器可以通过请求流发送一个 PUSH_PROMISE 帧，使该推送请求看上去像是一个响应，然后通过新的流发送实际响应。")]),t._v(" "),_("p",[t._v("虽然客户端之前已经表示过推送可接受，但如果客户端认为适合，每个推送流仍可以随时取消，然后发送一个 CANCEL_PUSH 帧到服务器。")]),t._v(" "),_("h3",{attrs:{id:"问题重重"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#问题重重"}},[t._v("#")]),t._v(" 问题重重")]),t._v(" "),_("p",[t._v("这一特性在HTTP/2的讨论、开发、部署以来，它就备受争议、讨论和抨击。为了让它变得有用，人们付出了许多努力。")]),t._v(" "),_("p",[t._v("推送从来不是没有代价的，尽管它省了半个往返的延迟，它还是会消耗带宽。服务器也很难或不可能从高层面确定一个资源是否应该被推送过去。")]),t._v(" "),_("h2",{attrs:{id:"与http-2的比较"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#与http-2的比较"}},[t._v("#")]),t._v(" 与HTTP/2的比较")]),t._v(" "),_("h3",{attrs:{id:"http-3与http-2的比较"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#http-3与http-2的比较"}},[t._v("#")]),t._v(" HTTP/3与HTTP/2的比较")]),t._v(" "),_("p",[t._v("HTTP/3基于QUIC设计，QUIC是一个自己处理数据流的传输层协议。")]),t._v(" "),_("p",[t._v("HTTP/2基于TCP设计，因此数据流在HTTP层处理。")]),t._v(" "),_("h3",{attrs:{id:"相似之处"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#相似之处"}},[t._v("#")]),t._v(" 相似之处")]),t._v(" "),_("p",[t._v("这两个协议为客户端提供了几乎相同的功能集。")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("两者都提供数据流")])]),t._v(" "),_("li",[_("p",[t._v("两者都提供服务器推送")])]),t._v(" "),_("li",[_("p",[t._v("两者都有头部压缩，QPACK与HPACK的设计非常类似")])]),t._v(" "),_("li",[_("p",[t._v("两者都通过单一连接上的数据流提供复用")])]),t._v(" "),_("li",[_("p",[t._v("两者都提供数据流的优先度设置")])])]),t._v(" "),_("h3",{attrs:{id:"不同之处"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#不同之处"}},[t._v("#")]),t._v(" 不同之处")]),t._v(" "),_("p",[t._v("不同之处在于一些细节，主要是由于HTTP/3使用QUIC导致：")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("得益于QUIC的0-RTT握手，HTTP/3可以提供更好的早期数据支持，而TCP快速打开和TLS通常只能传输更少的数据，且经常存在问题。")])]),t._v(" "),_("li",[_("p",[t._v("得益于QUIC，HTTP/3的握手速度比TCP+TLS快得多。")])]),t._v(" "),_("li",[_("p",[t._v("HTTP/3不存在明文的不安全版本。尽管在互联网上很少见，HTTP/2还是可以不配合HTTPS来实现和使用。")])]),t._v(" "),_("li",[_("p",[t._v("通过ALPN拓展，HTTP/2可以直接在TLS握手时进行协商。HTTP/3基于QUIC，所以需要凭借响应中的 Alt-Svc: 头部来向客户端宣告。")])])])])}),[],!1,null,null,null);v.default=T.exports}}]);